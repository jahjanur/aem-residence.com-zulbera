# Deploying to Hostinger Node.js – Step-by-step

This guide assumes you already have a Hostinger account with **Node.js** hosting enabled (VPS or a plan that supports Node.js applications).

---

## If you see "Unsupported framework or invalid project structure"

Hostinger detects frameworks by looking at the **Application Root** folder. This repo is a **monorepo** (root has workspaces, no Express/Vite at root), so the root is often not recognized.

**Fix:** Set **Application Root** to **`apps/api`** (not the repo root). That folder contains the Express app, which Hostinger supports.

- **Application Root:** `apps/api`
- **Start command:** `node dist/index.js`
- **Build:** You must run the full build from the **repo root** so that `apps/api/dist` and `apps/api/public` exist:
  - From the folder that contains `apps/` and `package.json` run:  
    `npm ci && npm run build:zulbera`  
  - (Or `npm run build:deploy` if you are not using the `/zulbera` path.)
- **Environment variables:** Set them in the Hostinger panel for the Node app (they apply to the process started by the start command).

If your Hostinger panel only lets you choose the repo root, use **Application Root** = repo root, **Build command** = `npm ci && npm run build:zulbera`, **Start command** = `npm run start`. Some panels still show the error with monorepos; in that case use **Application Root** = `apps/api` and run the build from repo root (e.g. via SSH or deploy script).

---

## Codebase summary (for deployment)

| Item | Details |
|------|--------|
| **Structure** | Monorepo: `apps/api` (Express + TypeScript), `apps/web` (Vite + React), `packages/shared` |
| **Runtime** | Single Node.js process: API serves REST at `/auth`, `/orders`, `/products`, etc., and serves the built React SPA from `apps/api/public` |
| **Database** | Prisma; local dev uses SQLite. **Production:** use Hostinger MySQL (recommended) or keep SQLite on server |
| **Build** | From repo root: `npm ci` → `npm run build:deploy` (builds shared + api + web, then copies `apps/web/dist` → `apps/api/public`) |
| **Start** | From repo root: `npm run start` (runs `node dist/index.js` in `apps/api`) |
| **Node** | `engines.node": ">=18"` in root `package.json` |

---

## 1. Prepare the project locally

- Ensure Hostinger has **Node.js 18+** available (check in the Node.js app panel).
- If using **MySQL** (recommended on Hostinger):
  - In Hostinger, create a MySQL database and user; note the host, database name, user, and password.
  - In `apps/api/prisma/schema.prisma` set `provider = "mysql"` and keep `url = env("DATABASE_URL")`.
  - Create a MySQL-compatible migration or use `npx prisma db push` for initial schema (see DEPLOYMENT.md).

---

## 2. Upload the project to Hostinger

- Upload the **entire repo** (or push to Git and clone on the server) so the Hostinger **Application Root** is the folder that contains:
  - Root `package.json` (with workspaces and `build:deploy` / `start` scripts)
  - `apps/` (api + web)
  - `packages/` (shared)

- Do **not** rely on uploading `apps/api/public`: it is generated by `build:deploy` and is in `.gitignore`. You will run the build on the server (or in CI) so that `apps/api/public` exists after deploy.

---

## 3. Install dependencies and build on the server

SSH into the server (or use Hostinger’s “Run script” / terminal if available) and run from the **Application Root** (repo root):

```bash
npm ci
npm run build:deploy
```

- `build:deploy` builds shared, api, and web, then copies the web build into `apps/api/public`.
- After this, `apps/api/public` exists and the API will serve the SPA in production.

---

## 4. Environment variables (Hostinger Node.js app settings)

Set these in the Node.js app’s **Environment** (or `.env` in Application Root, depending on Hostinger):

| Variable | Example / notes |
|----------|------------------|
| `NODE_ENV` | `production` |
| `PORT` | Port Hostinger assigns (e.g. `4000`); use the one shown in the panel. |
| `DATABASE_URL` | MySQL: `mysql://USER:PASSWORD@HOST/DATABASE` or SQLite: `file:./prisma/dev.db` (ensure `apps/api/prisma` is writable). |
| `SESSION_SECRET` | Long random string (e.g. from `openssl rand -hex 32`). |
| `CORS_ORIGIN` | For same-origin leave unset or set to your app URL, e.g. `https://aem-residence.com`. |
| `BASE_PATH` | When the app is at **aem-residence.com/zulbera**, set `BASE_PATH=/zulbera` and use build command `npm run build:zulbera` (see below). |

For **same-origin** (one domain for API + frontend):

- Do **not** set `VITE_API_BASE` when building (or set to empty). The React app will call the API on the same host (`/auth`, `/orders`, etc.).

**Serving at aem-residence.com/zulbera (one of three sites on the same server):** Set `BASE_PATH=/zulbera` in the Node app environment. Use **Build command** `npm run build:zulbera` (from repo root) so the frontend and API use the `/zulbera` base path. Users will open **https://aem-residence.com/zulbera** to use this app.

---

## 5. Start command (Hostinger panel)

- **Application Root:** folder that contains root `package.json` and `apps/` (repo root).
- **Start command:**  
  `npm run start`  

This runs the API; in production the API also serves the React app from `apps/api/public`.

If Hostinger requires the process to run from a subfolder:

- **Application Root:** `apps/api`
- **Start command:** `node dist/index.js`  
  You must still run `npm run build:deploy` from the **repo root** so that `apps/api/public` exists and is up to date.

---

## 6. Database (first deploy)

- **MySQL:** Set `DATABASE_URL` in the Node app, then from repo root run:
  - `npx prisma migrate deploy`  
  or, if you use `db push` for initial schema:
  - `npx prisma db push`
  - Optionally: `npm run db:seed`
- **SQLite:** Set `DATABASE_URL=file:./prisma/dev.db`, ensure `apps/api/prisma` is writable, then run `npm run db:migrate` (and optionally `npm run db:seed`) from repo root.

---

## 7. Session and writable paths

- Sessions are stored on disk in `apps/api/prisma/sessions` (session-file-store). Ensure this directory exists and is writable by the Node process.
- If you use SQLite, `apps/api/prisma` must be writable for the DB file.

---

## 8. Quick checklist

- [ ] Node 18+ on Hostinger
- [ ] Repo uploaded/cloned; Application Root = repo root (or `apps/api` with start `node dist/index.js`)
- [ ] `npm ci` and `npm run build:deploy` run from repo root
- [ ] `NODE_ENV=production`, `PORT`, `DATABASE_URL`, `SESSION_SECRET` set; `CORS_ORIGIN` if needed
- [ ] Prisma: `provider = "mysql"` and migrations (or `db push`) + optional seed
- [ ] Start command: `npm run start` (from repo root) or `node dist/index.js` (from `apps/api`)
- [ ] `apps/api/prisma/sessions` (and `prisma` for SQLite) writable

For more on database options, PDFs, and multi-site setup, see **DEPLOYMENT.md**.
